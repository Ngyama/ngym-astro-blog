---
// Simple music player component
const musicFile = "/src/assets/music/理芽 - やさしくしないで.mp3"
const coverImage = "/src/assets/music/やさしくしないで.jpg"
---

<div class="music-player-simple">
  <div class="flex items-center gap-3">
    <div class="w-12 h-12 flex-shrink-0">
      <img id="coverImage" src={coverImage} alt="Album Cover" class="w-full h-full rounded-full object-cover transition-transform duration-300" />
    </div>
    
    <div class="flex-1">
      <div class="text-sm font-medium text-foreground truncate">やさしくしないで</div>
      <div class="text-xs text-muted-foreground truncate">理芽</div>
    </div>
    
    <button id="playPauseBtn" class="w-10 h-10 rounded-full bg-primary text-primary-foreground flex items-center justify-center hover:bg-primary/90 transition-colors">
      <svg id="playIcon" class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
        <path d="M8 5v14l11-7z"/>
      </svg>
      <svg id="pauseIcon" class="w-5 h-5 hidden" viewBox="0 0 24 24" fill="currentColor">
        <path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/>
      </svg>
    </button>
  </div>
  
  <div class="mt-3">
    <div id="progressBar" class="w-full h-1 bg-muted rounded-full cursor-pointer">
      <div id="progress" class="h-full bg-primary rounded-full transition-all duration-300" style="width: 0%"></div>
    </div>
    <div class="flex justify-between text-xs text-muted-foreground mt-1">
      <span id="currentTime">0:00</span>
      <span id="duration">0:00</span>
    </div>
  </div>
</div>

<style>
  .music-player-simple {
    @apply p-4 bg-card/30 border rounded-lg backdrop-blur-sm;
  }
  
  .cover-rotating {
    animation: rotate 4s linear infinite;
  }
  
  @keyframes rotate {
    from {
      transform: rotate(0deg);
    }
    to {
      transform: rotate(360deg);
    }
  }
</style>

<script define:vars={{ musicFile }}>
  class SimpleMusicPlayer {
    constructor() {
      this.audio = new Audio(musicFile);
      this.isPlaying = false;
      
      this.initializeElements();
      this.attachEventListeners();
      this.setupAudio();
    }

    initializeElements() {
      this.playPauseBtn = document.getElementById('playPauseBtn');
      this.progress = document.getElementById('progress');
      this.progressBar = document.getElementById('progressBar');
      this.currentTimeEl = document.getElementById('currentTime');
      this.durationEl = document.getElementById('duration');
      this.playIcon = document.getElementById('playIcon');
      this.pauseIcon = document.getElementById('pauseIcon');
      this.coverImage = document.getElementById('coverImage');
    }

    attachEventListeners() {
      this.playPauseBtn.addEventListener('click', () => this.togglePlayPause());
      
      this.progressBar.addEventListener('click', (e) => {
        if (this.audio.duration) {
          const rect = e.currentTarget.getBoundingClientRect();
          const clickX = e.clientX - rect.left;
          const width = rect.width;
          const percentage = clickX / width;
          this.audio.currentTime = percentage * this.audio.duration;
        }
      });
    }

    setupAudio() {
      this.audio.addEventListener('loadedmetadata', () => {
        this.durationEl.textContent = this.formatTime(this.audio.duration);
      });

      this.audio.addEventListener('timeupdate', () => {
        this.updateProgress();
        this.currentTimeEl.textContent = this.formatTime(this.audio.currentTime);
      });

      this.audio.addEventListener('ended', () => {
        this.pause();
        this.stopRotation();
      });
    }

    togglePlayPause() {
      if (this.isPlaying) {
        this.pause();
      } else {
        this.play();
      }
    }

    play() {
      this.audio.play();
      this.isPlaying = true;
      this.updatePlayPauseButton();
      this.startRotation();
    }

    pause() {
      this.audio.pause();
      this.isPlaying = false;
      this.updatePlayPauseButton();
      this.stopRotation();
    }

    updateProgress() {
      if (this.audio.duration) {
        const percentage = (this.audio.currentTime / this.audio.duration) * 100;
        this.progress.style.width = percentage + '%';
      }
    }

    updatePlayPauseButton() {
      if (this.isPlaying) {
        this.playIcon.classList.add('hidden');
        this.pauseIcon.classList.remove('hidden');
      } else {
        this.playIcon.classList.remove('hidden');
        this.pauseIcon.classList.add('hidden');
      }
    }

    startRotation() {
      this.coverImage.classList.add('cover-rotating');
    }

    stopRotation() {
      this.coverImage.classList.remove('cover-rotating');
    }

    formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    new SimpleMusicPlayer();
  });
</script>